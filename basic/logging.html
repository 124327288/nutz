<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head><meta HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=UTF-8"/>
<title>Log配置</title><link href="../zdoc.css" rel="stylesheet" type="text/css"/>
</head>
<body><a name="top"></a>
<div class="zdoc_header">Log配置</div>
<div class="zdoc_author"><em>By:</em><b>wendal</b><a href="mailto:wendal1985@gmail.com">&lt;wendal1985@gmail.com&gt;</a></div>
<div class="zdoc_body">
<ul class="zdoc_index_table">
<li>
<div><span class="num">1</span><a href="#一个老生常谈的问题">一个老生常谈的问题</a></div>
</li>
<li>
<div><span class="num">2</span><a href="#解答">解答</a></div>
</li>
</ul>
<div class="hr"><b></b></div>
<h1><a name="一个老生常谈的问题"></a>一个老生常谈的问题</h1>
<div style="float:right;"><a href="#top">Top</a></div>
<ol type="1">
<li>Nutz需要第三方jar包才能运行吗? 答案是,不需要.但如果有的话更好.</li>
<li>一般有几种疑问:
<ol type="a">
<li>刚刚接触Nutz,直接把nutz.jar扔进工程,发现正常运行起来了</li>
<li>读源码,发现源码其实是依赖Log4j的几个类的,但为什么没有log4j的jar,Nutz也正常运行了呢?</li>
<li>想把日志输出到log4j,加上log4j的jar,发现nutz的日志就按log4j的设置输出了</li>
<li>不想使用log4j,想使用更高效的Logback或者传统的JDK Logging,不知道行不行?</li>
</ol>
</li>
</ol>
<div class="hr"><b></b></div>
<h1><a name="解答"></a>解答</h1>
<div style="float:right;"><a href="#top">Top</a></div>
<ol type="1">
<li>Nutz的源码中,依赖两个外部jar -- servlet-api.jar 和 log4j.jar
<ol type="a">
<li>前者在任何标准J2EE Web应用中都有, Nutz仅支持Servlet 2.4或以上.</li>
<li>后者是极其常见的Log4j, 编译器依赖于1.2.17版,但在运行时仅要求是1.2.x.</li>
</ol>
</li>
<li>我们使用Nutz.Plugin,通过检测是否存在Log4j的核心接口 org.apache.log4j.Log是否存在来判断是否将日志输出到Log4j
<ol type="a">
<li>由于仅检测是否存在org.apache.log4j.Log接口,这样就导致两个情况:
<ol type="i">
<li>仅仅把Log4j的jar放进classpath,而没有配置之,那么输出日志时,log4j会警告你. 我们认为这是你的失误.</li>
<li>这样也提供了一个自由度,因为slf4j的log4j-over-slf4j桥也提供这个接口.
<p>换句话说,如果你把log4j-over-slf4j.jar放进classpath,那么Nutz的日志也能通过Slf4j输出去.</p>
</li>
</ol>
</li>
</ol>
</li>
</ol>
<div class="hr"><b></b></div>
<ol type="1">
<li>最精简搭配,默认输出的就是Debug信息,完全无鸭梨!!
<p>不添加任何日志库的时候, nutz会将DEBUG/INFO输出到stdout, WARN/ERROR输出到stderr</p>
</li>
<li>配最新的 log4j 1.2.x
<ul type="disc">
<li>nutz.jar + log4j-1.2.17.jar</li>
</ul>
<pre>&lt;dependency&gt;
	&lt;groupId&gt;org.nutz&lt;/groupId&gt;
	&lt;artifactId&gt;nutz&lt;/artifactId&gt;
	&lt;version&gt;${nutz.version}&lt;/version&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
	&lt;groupId&gt;log4j&lt;/groupId&gt;
	&lt;artifactId&gt;log4j&lt;/artifactId&gt;
	&lt;version&gt;1.2.17&lt;/version&gt;
&lt;/dependency&gt;
</pre>
<ul type="disc">
<li>记得添加log4j.properties到resources目录(maven) 或 src目录(eclipse普通项目)</li>
</ul>
<pre>log4j.rootLogger=debug,Console

log4j.appender.Console=org.apache.log4j.ConsoleAppender
log4j.appender.Console.layout=org.apache.log4j.PatternLayout
log4j.appender.Console.layout.ConversionPattern=[%-5p] %d{HH:mm:ss.SSS} %l - %m%n
</pre>
</li>
<li>使用 Logback
<ul type="disc">
<li>nutz.jar + log4j-over-slf4j.jar + logback-classic.jar</li>
</ul>
<pre>&lt;dependency&gt;
	&lt;groupId&gt;org.nutz&lt;/groupId&gt;
	&lt;artifactId&gt;nutz&lt;/artifactId&gt;
	&lt;version&gt;${nutz.version}&lt;/version&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
	&lt;groupId&gt;org.slf4j&lt;/groupId&gt;
	&lt;artifactId&gt;log4j-over-slf4j&lt;/artifactId&gt;
	&lt;version&gt;1.7.21&lt;/version&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
	&lt;groupId&gt;ch.qos.logback&lt;/groupId&gt;
	&lt;artifactId&gt;logback-classic&lt;/artifactId&gt;
	&lt;version&gt;1.1.8&lt;/version&gt;
&lt;/dependency&gt;
</pre>
<p>请检查依赖关系中是否存在log4j 1.2.x的jar,如果存在,需要删除掉</p>
</li>
</ol>
<ul type="disc">
<li>使用log4j 2.x
<ul type="circle">
<li>nutz.jar + log4j-1.2-api.jar + log4j-2.6.jar</li>
</ul>
<pre>	&lt;dependency&gt;
		&lt;groupId&gt;org.apache.logging.log4j&lt;/groupId&gt;
		&lt;artifactId&gt;log4j-core&lt;/artifactId&gt;
		&lt;version&gt;2.6&lt;/version&gt;
	&lt;/dependency&gt;
	&lt;dependency&gt;
		&lt;groupId&gt;org.apache.logging.log4j&lt;/groupId&gt;
		&lt;artifactId&gt;log4j-slf4j-impl&lt;/artifactId&gt;
		&lt;version&gt;2.6&lt;/version&gt;
	&lt;/dependency&gt;
	&lt;dependency&gt;
		&lt;groupId&gt;org.apache.logging.log4j&lt;/groupId&gt;
		&lt;artifactId&gt;log4j-1.2-api&lt;/artifactId&gt;
		&lt;version&gt;2.6&lt;/version&gt;
	&lt;/dependency&gt;
	&lt;dependency&gt;
		&lt;groupId&gt;org.apache.logging.log4j&lt;/groupId&gt;
		&lt;artifactId&gt;log4j-web&lt;/artifactId&gt;
		&lt;version&gt;2.6&lt;/version&gt;
	&lt;/dependency&gt;
</pre>
<p>注意,log4j 2.x使用的是log4j2.xml</p>
<pre>&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;Configuration&gt;
&lt;Appenders&gt;
&lt;Console name="STDOUT" target="SYSTEM_OUT"&gt;
  &lt;PatternLayout pattern="%d{HH:mm:ss.SSS} %-5p (%F:%L) %M - %m%n"/&gt;
&lt;/Console&gt;
&lt;/Appenders&gt;
&lt;Loggers&gt;
&lt;Root level="debug"&gt;
  &lt;AppenderRef ref="STDOUT"/&gt;
&lt;/Root&gt;
&lt;/Loggers&gt;
&lt;/Configuration&gt;
</pre>
</li>
</ul>
</div>
<div class="zdoc_footer"><em>By:</em><b>wendal</b><a href="mailto:wendal1985@gmail.com">&lt;wendal1985@gmail.com&gt;</a></div>
</body>
</html>
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head><meta HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=UTF-8"/>
<title>更底层定制NutDao</title><link href="../zdoc.css" rel="stylesheet" type="text/css"/>
</head>
<body><a name="top"></a>
<div class="zdoc_header">更底层定制NutDao</div>
<div class="zdoc_author"><em>By:</em><b>zozoh</b><a href="mailto:zozohtnt@gmail.com">&lt;zozohtnt@gmail.com&gt;</a></div>
<div class="zdoc_body">
<ul class="zdoc_index_table">
<li>
<div><span class="num">1</span><a href="#Dao_接口的默认实现_NutDao">Dao 接口的默认实现 NutDao</a></div>
</li>
<li>
<div><span class="num">2</span><a href="#完全控制SQL语句的执行">完全控制SQL语句的执行</a></div>
</li>
<li>
<div><span class="num">3</span><a href="#同_Spring_事务整合的例子">同 Spring 事务整合的例子</a></div>
</li>
</ul>
<div class="hr"><b></b></div>
<h1><a name="Dao_接口的默认实现_NutDao"></a>Dao 接口的默认实现 NutDao</h1>
<div style="float:right;"><a href="#top">Top</a></div>
<p>Nutz 的 Dao 接口是它最大的一个接口，这个接口封装了一组更便利的数据库操作，同时 Nutz 也提供了一个默认的实现 : <span style="color:#0000AA;"><b>org.nutz.dao.impl.NutDao</b></span>，基本上这个实现足够你使用。但是有些时候你希望对它进行更加深刻的，触及灵魂的定制，比如你打算让 Dao 的使用 Spring 的事务管理器等等，那么你可以读读这篇文档，它告诉你几个 NutDao 类的几个扩展点，可以让你更加底层定制 NutDao</p>
<div class="hr"><b></b></div>
<h1><a name="完全控制SQL语句的执行"></a>完全控制SQL语句的执行</h1>
<div style="float:right;"><a href="#top">Top</a></div>
<p>NutDao 中无论任何操作，最终都要生成一个 SQL 语句，并传入给 JDBC 来执行。</p>
<ul type="disc">
<li>PojoMaker 接口负责语句的生成</li>
<li>DaoExecutor 接口负责语句的执行</li>
</ul>
<p>我们很鼓励你自己实现自己的 DaoExecutor 接口替换掉默认的实现，但是 PojoMaker 接口则暂时不建议你这么做，因为里面的逻辑稍微有点复杂，你非常容易弄错。</p>
<p>DaoExecutor 接口的源码如下：</p>
<pre>public interface DaoExecutor {
    void exec(Connection conn, DaoStatement st);
}
</pre>
<p>它的实现类面对的是一个 DaoStatement，无论你是用自定义SQL，还是直接操作 POJO，最后NutDao都要生成DaoStatement 接口的一个实例，然后交付给 DaoExecutor 来运行. </p>
<p>Nutz 默认提供的 NutDaoExecutor 也不太复杂，算上空行和注释，240多行，你如果有兴趣看看它的源码，它倒是能成为你自定义 DaoExecutor 的一个很好的参考。</p>
<p>总之，通过 DaoExecutor 接口，你可以完全控制单条SQL语句的执行，当然，到现在，似乎还没有人明确的希望控制这个接口，大家都在用 Nutz 的默认实现。</p>
<div class="hr"><b></b></div>
<h1><a name="同_Spring_事务整合的例子"></a>同 Spring 事务整合的例子</h1>
<div style="float:right;"><a href="#top">Top</a></div>
<pre>&lt;bean id="nutDao" class="org.nutz.dao.impl.NutDao"&gt;
    &lt;property name="dataSource" ref="dataSource"/&gt;
    &lt;!-- 如果要使用Trans,移除springDaoRunner --&gt;
    &lt;property name="runner" ref="springDaoRunner"/&gt;
&lt;/bean&gt;
&lt;bean id="springDaoRunner" class="org.nutz.integration.spring.SpringDaoRunner"&gt;
&lt;/bean&gt;
</pre>
<p>SpringDaoRunner类可以在<a href="https://github.com/nutzam/nutzmore/tree/master/nutz-integration-spring">nutz-integration-spring</a> （<a href="https://git.oschina.net/nutz/nutzmore/tree/master/nutz-integration-spring">Git@OSC镜像</a>）中找到</p>
</div>
<div class="zdoc_footer"><em>By:</em><b>zozoh</b><a href="mailto:zozohtnt@gmail.com">&lt;zozohtnt@gmail.com&gt;</a></div>
</body>
</html>
<html>
<head>
<title>事件监听</title>
</head>
<body><a name="top"></a>
<div class="zdoc_header">事件监听</div>
<div class="zdoc_author"><em>By:</em><b>zozoh</b><a href="mailto:zozohtnt@gmail.com">&lt;zozohtnt@gmail.com&gt;</a></div>
<div class="zdoc_body">
<h1>都有哪些事件</h1>
<p>Nutz.Ioc 容器有三种事件：</p>
<ul type="disc">
<li>对象被创建</li>
<li>对象被从容器中取出</li>
<li>对象被销毁</li>
</ul>
<p>在这三种时刻，你如果想做一些特殊的操作，比如，当一个数据源被销毁时，你希望能够关闭所有的连接，你可以在 JSON 配置文件中，声明一下，你想监听什么事件，以及怎么监听。</p>
<h1>怎么监听</h1>
<p>我们为 Pet 对象增加一个新的属性:</p>
<pre>public class Pet {

	private int fetchCount;
	
	... <span class="zdoc_code_cmt">// 省略其他属性以及 getter 和 setter
</span></pre>
<h2>通过实现一个触发器</h2>
<h3>触发器</h3>
<pre>package nutz.demo.ioc.book;<span class="zdoc_code_cmt">//提醒: 不要把你的类放在缺省包中!!
</span>
import org.nutz.ioc.IocEventTrigger;

public class OnFetchPet implements IocEventTrigger&lt;Pet&gt; {

	public void trigger(Pet pet) {
		pet.setFetchCount(pet.getFetchCount() + 1);
	}

}
</pre>
<p>IocEventTrigger 接口只有一个方法，当它被调用的时候，就表示某个事件发生了。具体什么事件呢？完全看你在 JSON 配置文件中把这个触发器，声明在哪种事件下面</p>
<h3>在 JSON 配置文件中声明监听的事件</h3>
<pre>var ioc = {
	xb : {
		events : {
			fetch : 'nutz.demo.ioc.book.OnFetchPet'
		},
		fields : {
			name : 'XiaoBai'
		}
	}
}
</pre>
<h3>调用代码</h3>
<pre>Ioc ioc = new NutIoc(new JsonLoader("nutz/demo/ioc/book/events.js"));
Pet pet = ioc.get(Pet.class, "xb");
ioc.get(Pet.class, "xb");
ioc.get(Pet.class, "xb");
System.out.printf("%s be fetch %d times", pet.getName(), pet.getFetchCount());
</pre>
<h3>控制台输出</h3>
<pre>XiaoBai be fetch 3 times
</pre>
<h2>通过对象自身的一个函数</h2>
<p>这个函数必须为  public，并且不能有参数</p>
<h3>为 Pet 对象增加一个函数：</h3>
<pre>public void onFetch() {
	this.fetchCount++;
}
</pre>
<h3>在 JSON 配置文件中增加新的对象</h3>
<pre>xh : {
	events : {
		fetch : 'onFetch'
	},
	fields : {
		name : 'XiaoHei'
	}
}
</pre>
<h3>调用代码</h3>
<pre>Pet xh = ioc.get(Pet.class, "xh");
ioc.get(Pet.class, "xh");
System.out.printf("%s be fetch %d times\n", xh.getName(), xh.getFetchCount());
</pre>
<h3>控制台输出</h3>
<pre>XiaoHei be fetch 2 times
</pre>
<h1>监听其他事件</h1>
<pre>events : {
	fetch  : ... ,
	create : ... ,
	depose : ...
}
</pre>
<p>根据需要，你可以选择上述三个事件，为其声明触发器，或者触发函数。</p>
</div>
<div class="zdoc_footer"><em>By:</em><b>zozoh</b><a href="mailto:zozohtnt@gmail.com">&lt;zozohtnt@gmail.com&gt;</a></div>
</body>
</html>